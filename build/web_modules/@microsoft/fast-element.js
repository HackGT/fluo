import{O as v,S as V,D as b,a as I,H as D}from"../common/ref-341a2b52.js";export{F as FASTElement,b as attr,d as css,c as customElement,h as html,o as observable,r as ref}from"../common/ref-341a2b52.js";const j=Object.freeze([]);function u(e,t,i){return{index:e,removed:t,addedCount:i}}const C=0,A=1,x=2,w=3;function k(e,t,i,o,s,l){const h=l-s+1,c=i-t+1,n=new Array(h);let r,d;for(let a=0;a<h;++a)n[a]=new Array(c),n[a][0]=a;for(let a=0;a<c;++a)n[0][a]=a;for(let a=1;a<h;++a)for(let p=1;p<c;++p)e[t+p-1]===o[s+a-1]?n[a][p]=n[a-1][p-1]:(r=n[a-1][p]+1,d=n[a][p-1]+1,n[a][p]=r<d?r:d);return n}function P(e){let t=e.length-1,i=e[0].length-1,o=e[t][i];const s=[];for(;t>0||i>0;){if(t===0){s.push(x),i--;continue}if(i===0){s.push(w),t--;continue}const l=e[t-1][i-1],h=e[t-1][i],c=e[t][i-1];let n;h<c?n=h<l?h:l:n=c<l?c:l,n===l?(l===o?s.push(C):(s.push(A),o=l),t--,i--):n===h?(s.push(w),t--,o=h):(s.push(x),i--,o=c)}return s.reverse(),s}function R(e,t,i){for(let o=0;o<i;++o)if(e[o]!==t[o])return o;return i}function $(e,t,i){let o=e.length,s=t.length,l=0;for(;l<i&&e[--o]===t[--s];)l++;return l}function z(e,t,i,o){return t<i||o<e?-1:t===i||o===e?0:e<i?t<o?t-i:o-i:o<t?o-e:t-e}function B(e,t,i,o,s,l){let h=0,c=0;const n=Math.min(i-t,l-s);if(t===0&&s===0&&(h=R(e,o,n)),i===e.length&&l===o.length&&(c=$(e,o,n-h)),t+=h,s+=h,i-=c,l-=c,i-t===0&&l-s===0)return j;if(t===i){const m=u(t,[],0);for(;s<l;)m.removed.push(o[s++]);return[m]}else if(s===l)return[u(t,[],i-t)];const r=P(k(e,t,i,o,s,l)),d=[];let a,p=t,f=s;for(let m=0;m<r.length;++m)switch(r[m]){case C:a!==void 0&&(d.push(a),a=void 0),p++,f++;break;case A:a===void 0&&(a=u(p,[],0)),a.addedCount++,p++,a.removed.push(o[f]),f++;break;case x:a===void 0&&(a=u(p,[],0)),a.addedCount++,p++;break;case w:a===void 0&&(a=u(p,[],0)),a.removed.push(o[f]),f++;break}return a!==void 0&&d.push(a),d}const O=Array.prototype.push;function L(e,t,i,o){const s=u(t,i,o);let l=!1,h=0;for(let c=0;c<e.length;c++){const n=e[c];if(n.index+=h,l)continue;const r=z(s.index,s.index+s.removed.length,n.index,n.index+n.addedCount);if(r>=0){e.splice(c,1),c--,h-=n.addedCount-n.removed.length,s.addedCount+=n.addedCount-r;const d=s.removed.length+n.removed.length-r;if(!s.addedCount&&!d)l=!0;else{let a=n.removed;if(s.index<n.index){const p=s.removed.slice(0,n.index-s.index);O.apply(p,a),a=p}if(s.index+s.removed.length>n.index+n.addedCount){const p=s.removed.slice(n.index+n.addedCount-s.index);O.apply(a,p)}s.removed=a,n.index<s.index&&(s.index=n.index)}}else if(s.index<n.index){l=!0,e.splice(c,0,s),c++;const d=s.addedCount-s.removed.length;n.index+=d,h+=d}}l||e.push(s)}function E(e){const t=[];for(let i=0,o=e.length;i<o;i++){const s=e[i];L(t,s.index,s.removed,s.addedCount)}return t}function Q(e,t){let i=[];const o=E(t);for(let s=0,l=o.length;s<l;++s){const h=o[s];if(h.addedCount===1&&h.removed.length===1){h.removed[0]!==e[h.index]&&i.push(h);continue}i=i.concat(B(e,h.index,h.index+h.addedCount,h.removed,0,h.removed.length))}return i}let T=!1;function y(e,t){let i=e.index;const o=t.length;return i>o?i=o-e.addedCount:i<0&&(i=o+e.removed.length+i-e.addedCount),i<0&&(i=0),e.index=i,e}class W extends V{constructor(e){super(e);this.oldCollection=void 0,this.splices=void 0,this.needsQueue=!0,this.call=this.flush,e.$fastController=this}addSplice(e){this.splices===void 0?this.splices=[e]:this.splices.push(e),this.needsQueue&&(this.needsQueue=!1,b.queueUpdate(this))}reset(e){this.oldCollection=e,this.needsQueue&&(this.needsQueue=!1,b.queueUpdate(this))}flush(){const e=this.splices,t=this.oldCollection;if(e===void 0&&t===void 0)return;this.needsQueue=!0,this.splices=void 0,this.oldCollection=void 0;const i=t===void 0?Q(this.source,e):B(this.source,0,this.source.length,t,0,t.length);this.notify(i)}}function F(){if(T)return;T=!0,v.setArrayObserverFactory(n=>new W(n));const e=Array.prototype,t=e.pop,i=e.push,o=e.reverse,s=e.shift,l=e.sort,h=e.splice,c=e.unshift;e.pop=function(){const n=this.length>0,r=t.apply(this,arguments),d=this.$fastController;return d!==void 0&&n&&d.addSplice(u(this.length,[r],0)),r},e.push=function(){const n=i.apply(this,arguments),r=this.$fastController;return r!==void 0&&r.addSplice(y(u(this.length-arguments.length,[],arguments.length),this)),n},e.reverse=function(){let n;const r=this.$fastController;r!==void 0&&(r.flush(),n=this.slice());const d=o.apply(this,arguments);return r!==void 0&&r.reset(n),d},e.shift=function(){const n=this.length>0,r=s.apply(this,arguments),d=this.$fastController;return d!==void 0&&n&&d.addSplice(u(0,[r],0)),r},e.sort=function(){let n;const r=this.$fastController;r!==void 0&&(r.flush(),n=this.slice());const d=l.apply(this,arguments);return r!==void 0&&r.reset(n),d},e.splice=function(){const n=h.apply(this,arguments),r=this.$fastController;return r!==void 0&&r.addSplice(y(u(+arguments[0],n,arguments.length>2?arguments.length-2:0),this)),n},e.unshift=function(){const n=c.apply(this,arguments),r=this.$fastController;return r!==void 0&&r.addSplice(y(u(0,[],arguments.length),this)),n}}function M(e,t){const i=typeof t=="function"?t:()=>t;return(o,s)=>e(o,s)?i(o,s):null}const N=Object.freeze({positioning:!1});function U(e,t,i,o){e.bind(t[i],o)}function _(e,t,i,o){const s=Object.create(o);s.index=i,s.length=t.length,e.bind(t[i],s)}class q{constructor(e,t,i,o,s,l){this.location=e,this.itemsBinding=t,this.templateBinding=o,this.options=l,this.source=null,this.views=[],this.items=null,this.itemsObserver=null,this.originalContext=void 0,this.childContext=void 0,this.bindView=U,this.itemsBindingObserver=v.binding(t,this,i),this.templateBindingObserver=v.binding(o,this,s),l.positioning&&(this.bindView=_)}bind(e,t){this.source=e,this.originalContext=t,this.childContext=Object.create(t),this.childContext.parent=e,this.childContext.parentContext=this.originalContext,this.items=this.itemsBindingObserver.observe(e,this.originalContext),this.template=this.templateBindingObserver.observe(e,this.originalContext),this.observeItems(),this.refreshAllViews()}unbind(){this.source=null,this.items=null,this.itemsObserver!==null&&this.itemsObserver.unsubscribe(this),this.unbindAllViews(),this.itemsBindingObserver.disconnect(),this.templateBindingObserver.disconnect()}handleChange(e,t){e===this.itemsBinding?(this.items=this.itemsBindingObserver.observe(this.source,this.originalContext),this.observeItems(),this.refreshAllViews()):e===this.templateBinding?(this.template=this.templateBindingObserver.observe(this.source,this.originalContext),this.refreshAllViews(!0)):this.updateViews(t)}observeItems(){this.items||(this.items=[]);const e=this.itemsObserver,t=this.itemsObserver=v.getNotifier(this.items);e!==t&&(e!==null&&e.unsubscribe(this),t.subscribe(this))}updateViews(e){const t=this.childContext,i=this.views,o=[],s=this.bindView;let l=0;for(let n=0,r=e.length;n<r;++n){const d=e[n],a=d.removed;o.push(...i.splice(d.index+l,a.length)),l-=d.addedCount}const h=this.items,c=this.template;for(let n=0,r=e.length;n<r;++n){const d=e[n];let a=d.index;const p=a+d.addedCount;for(;a<p;++a){const f=i[a],m=f?f.firstChild:this.location,g=o.length>0?o.shift():c.create();i.splice(a,0,g),s(g,h,a,t),g.insertBefore(m)}}for(let n=0,r=o.length;n<r;++n)o[n].dispose();if(this.options.positioning)for(let n=0,r=i.length;n<r;++n){const d=i[n].context;d.length=r,d.index=n}}refreshAllViews(e=!1){const t=this.items,i=this.childContext,o=this.template,s=this.location,l=this.bindView;let h=t.length,c=this.views,n=c.length;if((h===0||e)&&(D.disposeContiguousBatch(c),n=0),n===0){this.views=c=new Array(h);for(let r=0;r<h;++r){const d=o.create();l(d,t,r,i),c[r]=d,d.insertBefore(s)}}else{let r=0;for(;r<h;++r)if(r<n){const a=c[r];l(a,t,r,i)}else{const a=o.create();l(a,t,r,i),c.push(a),a.insertBefore(s)}const d=c.splice(r,n-r);for(r=0,h=d.length;r<h;++r)d[r].dispose()}}unbindAllViews(){const e=this.views;for(let t=0,i=e.length;t<i;++t)e[t].unbind()}}class H extends I{constructor(e,t,i){super();this.itemsBinding=e,this.templateBinding=t,this.options=i,this.createPlaceholder=b.createBlockPlaceholder,F(),this.isItemsBindingVolatile=v.isVolatileBinding(e),this.isTemplateBindingVolatile=v.isVolatileBinding(t)}createBehavior(e){return new q(e,this.itemsBinding,this.isItemsBindingVolatile,this.templateBinding,this.isTemplateBindingVolatile,this.options)}}function G(e,t,i=N){const o=typeof t=="function"?t:()=>t;return new H(e,o,i)}export{G as repeat,M as when};
